# we will use sqlite and PostgreSQL

#to create a database with sqlite

from fastapi import FastAPI
from sqlmodel import SQLModel, Field, Session, create_engine, select

app = FastAPI()

engine = create_engine("sqlite:///data/cansat.db")

class Measurement(SQLModel, table=True):
    id: int | None = Field(default=None, primary_key=True)
    temperature: float
    pressure: float
    altitude: float

@app.on_event("startup")
def on_startup():
    SQLModel.metadata.create_all(engine)

@app.post("/measurements/")
def add_measurement(m: Measurement):
    with Session(engine) as session:
        session.add(m)
        session.commit()
        session.refresh(m)
        return m

@app.get("/measurements/")
def list_measurements():
    with Session(engine) as session:
        return session.exec(select(Measurement)).all()

#Example form chatgpt

#for PostgreSQL only change the url 'cause it will be host on a pc